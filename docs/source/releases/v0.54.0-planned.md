# Polarway v0.54.0 Release Notes (Planned)

**Release Date:** TBD  
**Status:** ğŸš§ In Development

## ğŸ‰ Major Features

### Lakehouse Module â€” Delta Lake User Management

**What's New:**

- **Full Delta Lake Integration** â€” ACID-compliant user management with time-travel
- **Authentication System** â€” JWT-based auth with password hashing (argon2)
- **Role-Based Access Control** â€” 5 roles: guest, pending, registered, trader, admin
- **Session Management** â€” Token-based sessions with automatic expiration
- **Audit Logging** â€” Complete audit trail of all user actions
- **Time-Travel Queries** â€” Query users table at any version or timestamp
- **GDPR Compliance** â€” Right to deletion with full data removal
- **Table Optimization** â€” Compact, z-order, and vacuum operations
- **Billing Integration** â€” Track user actions and query costs

**API Stability:** âœ… Stable

**Rust Crate:** `polarway-lakehouse`

```rust
use polarway_lakehouse::{LakehouseConfig, DeltaStore};

let config = LakehouseConfig::builder()
    .base_path("/data/lakehouse")
    .jwt_secret("your-secret")
    .build()?;

let store = DeltaStore::new(config).await?;
```

**Python Client:**

```python
from polarway.lakehouse import LakehouseClient, SubscriptionTier

client = LakehouseClient("/data/lakehouse", jwt_secret="your-secret")

# Register user
user = client.register("alice", "alice@example.com", "password",
                       tier=SubscriptionTier.PIONEER)

# Login
token, user = client.login("alice", "password")

# Time-travel
users_v5 = client.read_users_at_version(5)
users_yesterday = client.read_users_at_timestamp("2026-02-10T00:00:00Z")

# Audit log
client.log_action(user.user_id, user.username, ActionType.LOGIN)
```

**Migration from SQLite:**

Set environment variable to switch backends:

```bash
# Enable lakehouse backend
export AUTH_BACKEND=lakehouse
export LAKEHOUSE_PATH=/data/lakehouse
export POLARWAY_JWT_SECRET=your-secret-key
```

**Documentation:**

- [Lakehouse Overview](../lakehouse.md)
- [Crate README](../../polarway-lakehouse/README.md)
- [Python Client API](../api/python.md#lakehouse)

**Tests:** 37 tests passing (8 unit, 9 auth, 9 store, 11 doc-tests)

**Dependencies:**

- `deltalake = "0.30"`
- `argon2 = "0.5"`
- `jsonwebtoken = "9"`
- `tokio = { version = "1", features = ["full"] }`
- `url = "2"`

## ğŸ› Bug Fixes

- Fixed deltalake 0.30 API compatibility (25 compilation errors resolved)
- Fixed deprecation warnings (DeltaOps â†’ direct DeltaTable methods)
- Fixed test failures (field name mismatches, validation errors)

## ğŸ“š Documentation

- **New:** Comprehensive lakehouse documentation
- **New:** Time-travel examples and use cases
- **New:** GDPR compliance guide
- **Updated:** Main README with lakehouse section
- **Updated:** mkdocs.yml navigation
- **Added:** ReadTheDocs lakehouse page

## ğŸ”§ Internal Changes

- Migrated from `DeltaOps` wrapper to direct `DeltaTable` methods
- Added `url::Url` type support for table paths
- Replaced `std::time::Duration` with `chrono::Duration` for vacuum
- Implemented `From<DataFusionError>` and `From<url::ParseError>` conversions
- Added `Array` trait imports for `is_null()` operations

## ğŸ“¦ Breaking Changes

**None** â€” This is a new module with no breaking changes to existing APIs.

## ğŸš€ Performance

- **ACID Transactions:** Full ACID compliance via Delta Lake
- **Optimized Writes:** Append-only with compaction
- **Fast Reads:** Parquet file format with predicate pushdown
- **Cache-Friendly:** Works with existing Polarway cache layer

## ğŸ”’ Security

- **Password Hashing:** Argon2 (memory-hard, resistant to GPU attacks)
- **JWT Tokens:** Signed with HS256, configurable expiry
- **Session Management:** Automatic token revocation
- **Audit Trail:** All actions logged with timestamps
- **GDPR Compliance:** Full data deletion support

## ğŸ“Š Storage Format

Delta Lake tables created:

1. **users** â€” User accounts (username, email, password_hash, role, etc.)
2. **sessions** â€” Active JWT sessions (token, user_id, expires_at)
3. **audit_log** â€” Action audit trail (user_id, action_type, timestamp, metadata)

## ğŸ¯ Use Cases

1. **Multi-Tenant Applications** â€” User management for SaaS platforms
2. **Audit Requirements** â€” Complete audit trail for compliance
3. **Time-Travel Debugging** â€” Query historical user state
4. **GDPR Compliance** â€” Right to deletion implementation
5. **Billing Integration** â€” Track usage for subscription models

## ğŸ› ï¸ Deployment

**Docker Environment:**

```dockerfile
ENV AUTH_BACKEND=lakehouse \
    LAKEHOUSE_PATH=/app/data/lakehouse \
    POLARWAY_JWT_SECRET=your-secret
```

**Volume Mount:**

```yaml
volumes:
  - ./data/lakehouse:/app/data/lakehouse
```

## ğŸ“ Known Issues

- JWT secret length warning (< 32 bytes) â€” use longer secrets in production
- Delta table vacuum requires manual trigger (no automatic scheduler yet)

## ğŸ”® Future Plans

- **v0.55.0:** Automatic table maintenance scheduler
- **v0.56.0:** Multi-tenancy with table isolation
- **v0.57.0:** Encryption at rest support

## ğŸ‘¥ Contributors

- Melvin Alvarez (@ThotDjehuty)

## ğŸ”— Related Issues

- #TBD â€” Initial lakehouse implementation
- #TBD â€” Delta Lake 0.30 API migration
- #TBD â€” GDPR compliance support

---

**Full Changelog:** https://github.com/ThotDjehuty/polarway/compare/v0.53.0...v0.54.0

**Download:** `pip install polarway==0.54.0` (when released)
